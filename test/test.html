<html>
<head>
    <script src="../skulpt_dist/skulpt.min.js" type="text/javascript"></script>
    <script src="../skulpt_dist/skulpt-stdlib.js" type="text/javascript"></script>
</head>

<body>
<div id="mycanvas" class="col-md-offset-4">
    <h5 id="titleHeading"></h5>
    <canvas id="pygameCanvas" width="400" height="200" style="border:1px solid #000000;"></canvas>
</div>
<textarea id="code" rows="24" cols="80">

</textarea>
<pre id="output"></pre>

<script>
    Sk.main_canvas = document.getElementById("pygameCanvas");
    Sk.title_container = document.getElementById("titleHeading");
    var basePath = '../pygame/';
    Sk.externalLibraries = {
        'pygame': {
            path: basePath + '__init__.js',
        },
        'pygame.display': {
            path: basePath + 'display.js',
        },
        'pygame.draw': {
            path: basePath + 'draw.js',
        },
        'pygame.event': {
            path: basePath + 'event.js',
        },
        'pygame.font': {
            path: basePath + 'font.js',
        },
        'pygame.image': {
            path: basePath + 'image.js',
        },
        'pygame.key': {
            path: basePath + 'key.js',
        },
        'pygame.mouse': {
            path: basePath + 'mouse.js',
        },
        'pygame.time': {
            path: basePath + 'time.js',
        },
        'pygame.transform': {
            path: basePath + 'transform.js',
        },
        'pygame.version': {
            path: basePath + 'version.js',
        },
    };

    function printString(text) {
        var output = document.getElementById("output");
        text = text.replace(/</g, '&lt;');
        output.innerHTML = output.innerHTML + text;
    }

    function builtinRead(x) {
        if (Sk.builtinFiles === undefined || Sk.builtinFiles["files"][x] === undefined)
            throw "File not found: '" + x + "'";
        return Sk.builtinFiles["files"][x];
    }

    function runCode() {
        var prog = document.getElementById("code").value;
        Sk.misceval.asyncToPromise(function () {
            try {
                return Sk.importMainWithBody("<stdin>", false, prog, true);
            } catch (e) {
                alert(e)
            }
        });
    }

    function loadCode(url, element) {
        req = new XMLHttpRequest();
        req.open("GET", url, false);
        req.send(null);
        element.innerHTML = req.responseText;
    }


    (Sk.TurtleGraphics || (Sk.TurtleGraphics = {})).target = 'mycanvas';
    Sk.configure({read: builtinRead, output: printString});
    // $("#code").load(window.location.search.substring(1), function () {
    //     runCode();
    // });
    loadCode(window.location.search.substring(1), document.getElementById("code"));
    runCode();
</script>
</body>
</html>

